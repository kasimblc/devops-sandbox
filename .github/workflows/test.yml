name: Staging Deploy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: >
          Deployment Environment.
          'all' → tüm staging deploy'ları çalışır,
          'staging-1', 'staging-2' gibi spesifik değerler.
        required: true
        default: "all"
        type: string
      action:
        description: "What action would you like to perform?"
        required: true
        default: "deploy"
        type: choice
        options:
          - deploy
          - rollback

jobs:
  deploy-staging:
    name: "Deploy Staging"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          clean: true

      - name: Read Environments File
        id: read-env
        run: |
          echo "Reading liste/environments.yml"
          SERVERS=$(yq eval '.environments["staging-list"].servers[].id' liste/environments.yml)
          echo "SERVERS=$SERVERS" >> $GITHUB_ENV

      - name: Set Matrix Environment
        run: echo "matrix=[$SERVERS]" >> $GITHUB_ENV

      - name: Test Deploy
        run: echo "Test Mode: Deploying to ${{ env.SERVERS }} with action ${{ inputs.action }}"
